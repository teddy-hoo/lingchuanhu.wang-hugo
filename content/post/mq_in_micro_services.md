---
title: "微服务中使用消息队列的必要性"
date: 2018-10-23T11:02:05+08:00
draft: true
tags: ["最佳实践"]
categories: ["web架构"]
---

> [原文地址](https://medium.com/startlovingyourself/need-of-messaging-queues-in-microservices-architecture-91de0db89120)

在我的上一篇文章中，我写过“微服务与单片架构”，它强调使用微服务架构的优势，同时也注重使用单片架构的缺点。现在您了解微服务架构的优势及其工作原理，它如何帮助您扩展应用程序，部署，更快地交付新功能，从而避免单点故障。

您很高兴使用微服务架构编写新应用程序。为了充分利用微服务架构，我们需要遵循某些标准或实践。消息队列就是其中之一（例如，兔子mq，kafka等）。我会继续写下一系列文章中的剩余实践。但为什么我会使用消息队列？如果不使用它会发生什么？我们将看到消息队列如何使我们的生活变得轻松，适用于微服务架构中的某些场景。



现在假设您有电子商务应用程序，用户来这里购买各种商品。并且他们获得一定的忠诚度积分，或者基于他们的活动的优惠券，例如。下订单，对所购商品进行审核等。每6个月，您想检查过去的用户活动流并更新其会员级别，忠诚度积分或优惠券。现在您需要提出一个可以将这些详细信息发送给用户的解决方案。让我们假设这里有两个服务，第一个是计算这些属性，第二个是基本上通过邮件，短信，推送通知向最终用户发送通知。因此，您会收到大量的第一个服务请求，这些服务可能会使用多个线程处理它。之后，您可能希望触摸消息服务，该服务负责向最终用户发送通知。

有两种方法可以处理它，第一种是休息同步模型，您可以在其中对消息传递服务进行外部调用并等待响应。第二个是基于消息传递的异步模型。

在第一种方法中，存在相当大的问题，例如您可能无法在非常短的时间内响应，因为可能存在大量请求，并且对于每个请求同步进行外部调用，它也会阻止当前线程，直到它从外部获得响应服务。可能存在外部服务中断的情况。您不确定消息传递服务的外部依赖性。它可能会导致响应延迟。同时，如果我们使用第二种方法，它基本上将这些更改/事件推送到队列/主题，并回复给用户。它还允许多个接收器异步处理这些消息，这可以帮助您提高性能。如果您在多个节点上运行它，可以为您提供高可用性的结果。因此，一旦将消息推送到队列，您的工作就完成了。消息队列将负责休息。你在这里没有阻止任何事情。因此，消费者/接收者可以从队列中读取消息，并异步处理它。可能有更多使用基于消息传递的模型的示例。

我们将看到使用基于队列的异步模型的更多用例，其中基本上您将更改事件推送到其他微服务以保持一致性。假设您正在与目录团队合作，该团队负责处理商家上传的产品，并将其映射到应用程序中产品的清洁模式。完成映射后，需要将此映射事件发送给其他服务，例如。搜索服务，为您提供基于此的映射产品。一旦搜索收到此信息，它就可以更新其产品，以便下次用户搜索时应该提供特定于映射产品的正确结果。让我们假设您在产品服务中对给定产品的属性进行了一些更改。您可能希望将这些更改推送到其他微服务，这些微服务基本上使用了一些基于产品的逻辑。如果你看一下这两个例子，你就不想阻止你当前的线程来处理它。让我们考虑另外一个用例，你也希望得到第二个服务的响应。由于消息传递队列提供单向通信，因此您需要在相反方向上再增加一个队列。

这就是基于消息传递的异步模型如何在某些情况下让您的生活变得轻松，例如。当外部服务中断，高延迟，可用性时，将更改事件发送到多个微服务，这会严重影响您的应用程序性能。它还提供微服务之间的松散耦合。
